@{
    ViewData["Title"] = "Bienvenido - Sistema de Apuestas";
}

@if (ViewBag.NumeroVisitas != null && ViewBag.NumeroVisitas > 1)
{
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        <i class="fas fa-user-clock me-2"></i>
        <strong>¡Bienvenido de vuelta!</strong> Esta es tu visita número <strong>@ViewBag.NumeroVisitas</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (!string.IsNullOrEmpty(ViewBag.TemaActual as string))
{
    <div class="alert alert-secondary alert-dismissible fade show d-flex justify-content-between align-items-center" role="alert">
        <div>
            <i class="fas fa-palette me-2"></i>
            Tema actual: <strong>@ViewBag.TemaActual</strong>
        </div>
        <div>
            <button type="button" class="btn btn-outline-primary btn-sm me-2" onclick="cambiarTema('claro')">
                <i class="fas fa-sun"></i> Claro
            </button>
            <button type="button" class="btn btn-outline-dark btn-sm me-2" onclick="cambiarTema('oscuro')">
                <i class="fas fa-moon"></i> Oscuro
            </button>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
}

<div class="container mt-5 animate-fade-in">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="apuesta-card text-center p-5">
                <h1 class="display-4 mb-4 text-primary">
                    <i class="fas fa-trophy"></i> APUESTA TOTAL
                </h1>
                <h2 class="mb-4 text-secondary">Tu casa de apuestas deportivas</h2>
                <p class="lead mb-4">Disfruta de las mejores cuotas en los partidos de las ligas más importantes del mundo.</p>
                
                <div class="row text-center mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="cuota-badge">
                            <i class="fas fa-futbol"></i><br>
                            <small>4 Ligas</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="cuota-badge">
                            <i class="fas fa-users"></i><br>
                            <small>Multijugador</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="cuota-badge">
                            <i class="fas fa-shield-alt"></i><br>
                            <small>Seguro</small>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="cuota-badge">
                            <i class="fas fa-mobile-alt"></i><br>
                            <small>Responsivo</small>
                        </div>
                    </div>
                </div>

                @if (User.Identity.IsAuthenticated)
                {
                    <div class="mb-4">
                        <h4 class="text-success">¡Bienvenido de vuelta, @await Component.InvokeAsync("NombreUsuario")!</h4>
                        <p class="text-muted">Ya puedes realizar tus apuestas</p>
                    </div>
                    <a asp-controller="Apuestas" asp-action="Index" class="btn btn-success-custom me-3">
                        <i class="fas fa-coins"></i> Ir a Apuestas
                    </a>
                    <a asp-controller="Apuestas" asp-action="MisApuestas" class="btn btn-outline-custom">
                        <i class="fas fa-list"></i> Mis Apuestas
                    </a>
                }
                else
                {
                    <div class="mb-4">
                        <h4 class="text-primary">¡Únete ahora y comienza a apostar!</h4>
                        <p class="text-muted">Regístrate gratis y recibe bonos de bienvenida</p>
                    </div>
                    <a asp-controller="Account" asp-action="Register" class="btn btn-primary-custom me-3">
                        <i class="fas fa-user-plus"></i> Registrarse
                    </a>
                    <a asp-controller="Account" asp-action="Login" class="btn btn-outline-custom">
                        <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
                    </a>
                }
            </div>
        </div>
    </div>
    
    <div class="row mt-5">
        <div class="col-md-4 mb-4">
            <div class="apuesta-card text-center p-4">
                <i class="fas fa-trophy fa-3x text-warning mb-3"></i>
                <h4>Premier League</h4>
                <p class="text-muted">Los mejores equipos de Inglaterra</p>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="apuesta-card text-center p-4">
                <i class="fas fa-futbol fa-3x text-danger mb-3"></i>
                <h4>La Liga</h4>
                <p class="text-muted">El fútbol español más emocionante</p>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="apuesta-card text-center p-4">
                <i class="fas fa-medal fa-3x text-success mb-3"></i>
                <h4>Serie A & Bundesliga</h4>
                <p class="text-muted">Italia y Alemania te esperan</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Función para cambiar tema
        function cambiarTema(tema) {
            fetch('@Url.Action("CambiarTema", "Home")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]') ? document.querySelector('input[name="__RequestVerificationToken"]').value : ''
                },
                body: 'tema=' + encodeURIComponent(tema)
            })
            .then(response => {
                if (response.ok) {
                    // Aplicar el tema inmediatamente
                    aplicarTema(tema);
                    
                    // Mostrar mensaje de éxito
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-success alert-dismissible fade show position-fixed';
                    alert.style.top = '20px';
                    alert.style.right = '20px';
                    alert.style.zIndex = '9999';
                    alert.innerHTML = `
                        <i class="fas fa-palette me-2"></i>Tema ${tema} aplicado correctamente!
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.body.appendChild(alert);
                    
                    // Auto-remover después de 2 segundos
                    setTimeout(() => {
                        if (alert.parentElement) {
                            alert.remove();
                        }
                    }, 2000);
                } else {
                    console.error('Error al cambiar tema');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        // Función para aplicar el tema visualmente
        function aplicarTema(tema) {
            const body = document.body;
            if (tema === 'oscuro') {
                body.classList.add('tema-oscuro');
                body.classList.remove('tema-claro');
            } else {
                body.classList.add('tema-claro');
                body.classList.remove('tema-oscuro');
            }
        }

        // Aplicar tema al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const temaActual = '@ViewBag.TemaActual';
            if (temaActual) {
                aplicarTema(temaActual);
            }
        });
    </script>
}
